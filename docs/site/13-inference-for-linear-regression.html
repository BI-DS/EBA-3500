<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data analysis with Programming - 12&nbsp; More linear regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<link href="../site/14-binary-regression.html" rel="next">
<link href="../site/12-basics-of-linear-regression.html" rel="prev">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../site/13-inference-for-linear-regression.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">More linear regression</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Data analysis with Programming</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/bi-ds/EBA-3500/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/00-python-tips.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python tips</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/01-scipy-numpy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to <code>Numpy</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/02-statistical-simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistical simulation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/03-limit-theorems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Limit theorems</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/04-exploratory-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/05-statistical-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Basic statistical models and the bootstrap</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/06-unbiased-estimators-efficiency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Unbiased estimators and efficiency</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/07-constructing-estimators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Constructing estimators</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/08-confidence-intervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Confidence intervals</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/09-testing-hypotheses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Testing hypotheses</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/10-statistical-learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Statistical learning, machine learning, and statistics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/12-basics-of-linear-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Basics of multiple linear regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/13-inference-for-linear-regression.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">More linear regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../site/14-binary-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Binary regression</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#curriculum" id="toc-curriculum" class="nav-link active" data-scroll-target="#curriculum"><span class="header-section-number">12.1</span> Curriculum</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">12.2</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#solution-to-3.15" id="toc-solution-to-3.15" class="nav-link" data-scroll-target="#solution-to-3.15"><span class="header-section-number">12.2.1</span> Solution to 3.15</a></li>
  </ul></li>
  <li><a href="#b" id="toc-b" class="nav-link" data-scroll-target="#b"><span class="header-section-number">13</span> (b)</a></li>
  <li><a href="#c" id="toc-c" class="nav-link" data-scroll-target="#c"><span class="header-section-number">14</span> (c)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">More linear regression</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Update 9/11.</strong> Added exercises and curriculum.</p>
</div>
</div>
<section id="curriculum" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="curriculum"><span class="header-section-number">12.1</span> Curriculum</h2>
<ul>
<li>James et al., Chapter 3.4 - 3.5</li>
</ul>
<p>The methods used in Chapter 3.4 are implemented in <a href="https://www.statsmodels.org/stable/examples/notebooks/generated/linear_regression_diagnostics_plots.html">here</a>. You need to copy the code for the class <code>LinearRegDiagnostic</code> into <code>Python</code> and run it. Make sure to important statsmodels using <code>import statsmodels</code> first. If you don’t, it won’t work.</p>
<p>You may want to take a look at the “official” slides for the chapter, found <a href="https://www.statlearning.com/resources-python">here</a>.</p>
</section>
<section id="exercises" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="exercises"><span class="header-section-number">12.2</span> Exercises</h2>
<p>The exercises this week overlap with last week, since the chapter is so large. All exercises (except those about KNN) are relevant and recommended.</p>
<section id="conceptual" class="level4" data-number="12.2.0.1">
<h4 data-number="12.2.0.1" class="anchored" data-anchor-id="conceptual"><span class="header-section-number">12.2.0.1</span> Conceptual</h4>
<ul>
<li>3.7.4 Verify your answers using a suitable Python simulation.</li>
<li>3.7.5</li>
</ul>
</section>
<section id="applied" class="level4" data-number="12.2.0.2">
<h4 data-number="12.2.0.2" class="anchored" data-anchor-id="applied"><span class="header-section-number">12.2.0.2</span> Applied</h4>
<ul>
<li>3.15</li>
<li>3.13</li>
<li>3.12</li>
</ul>
</section>
<section id="solution-to-3.15" class="level3" data-number="12.2.1">
<h3 data-number="12.2.1" class="anchored" data-anchor-id="solution-to-3.15"><span class="header-section-number">12.2.1</span> Solution to 3.15</h3>
<p>We import the usual stuff.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In addition, we will important <code>pprint</code>, which allows us to visualize lists and dictionaries easier.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pprint</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Import the data:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>boston <span class="op">=</span> pd.read_csv(<span class="st">"Boston.csv"</span>, na_values<span class="op">=</span><span class="st">"?"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>boston.drop(boston.columns[<span class="dv">0</span>], axis <span class="op">=</span> <span class="dv">1</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And have a short look at it.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>boston.info()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>boston.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 506 entries, 0 to 505
Data columns (total 13 columns):
 #   Column   Non-Null Count  Dtype  
---  ------   --------------  -----  
 0   crim     506 non-null    float64
 1   zn       506 non-null    float64
 2   indus    506 non-null    float64
 3   chas     506 non-null    int64  
 4   nox      506 non-null    float64
 5   rm       506 non-null    float64
 6   age      506 non-null    float64
 7   dis      506 non-null    float64
 8   rad      506 non-null    int64  
 9   tax      506 non-null    int64  
 10  ptratio  506 non-null    float64
 11  lstat    506 non-null    float64
 12  medv     506 non-null    float64
dtypes: float64(10), int64(3)
memory usage: 51.5 KB</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">crim</th>
<th data-quarto-table-cell-role="th">zn</th>
<th data-quarto-table-cell-role="th">indus</th>
<th data-quarto-table-cell-role="th">chas</th>
<th data-quarto-table-cell-role="th">nox</th>
<th data-quarto-table-cell-role="th">rm</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">dis</th>
<th data-quarto-table-cell-role="th">rad</th>
<th data-quarto-table-cell-role="th">tax</th>
<th data-quarto-table-cell-role="th">ptratio</th>
<th data-quarto-table-cell-role="th">lstat</th>
<th data-quarto-table-cell-role="th">medv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>506.000000</td>
<td>506.000000</td>
<td>506.000000</td>
<td>506.000000</td>
<td>506.000000</td>
<td>506.000000</td>
<td>506.000000</td>
<td>506.000000</td>
<td>506.000000</td>
<td>506.000000</td>
<td>506.000000</td>
<td>506.000000</td>
<td>506.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>3.613524</td>
<td>11.363636</td>
<td>11.136779</td>
<td>0.069170</td>
<td>0.554695</td>
<td>6.284634</td>
<td>68.574901</td>
<td>3.795043</td>
<td>9.549407</td>
<td>408.237154</td>
<td>18.455534</td>
<td>12.653063</td>
<td>22.532806</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>8.601545</td>
<td>23.322453</td>
<td>6.860353</td>
<td>0.253994</td>
<td>0.115878</td>
<td>0.702617</td>
<td>28.148861</td>
<td>2.105710</td>
<td>8.707259</td>
<td>168.537116</td>
<td>2.164946</td>
<td>7.141062</td>
<td>9.197104</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.006320</td>
<td>0.000000</td>
<td>0.460000</td>
<td>0.000000</td>
<td>0.385000</td>
<td>3.561000</td>
<td>2.900000</td>
<td>1.129600</td>
<td>1.000000</td>
<td>187.000000</td>
<td>12.600000</td>
<td>1.730000</td>
<td>5.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.082045</td>
<td>0.000000</td>
<td>5.190000</td>
<td>0.000000</td>
<td>0.449000</td>
<td>5.885500</td>
<td>45.025000</td>
<td>2.100175</td>
<td>4.000000</td>
<td>279.000000</td>
<td>17.400000</td>
<td>6.950000</td>
<td>17.025000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.256510</td>
<td>0.000000</td>
<td>9.690000</td>
<td>0.000000</td>
<td>0.538000</td>
<td>6.208500</td>
<td>77.500000</td>
<td>3.207450</td>
<td>5.000000</td>
<td>330.000000</td>
<td>19.050000</td>
<td>11.360000</td>
<td>21.200000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>3.677083</td>
<td>12.500000</td>
<td>18.100000</td>
<td>0.000000</td>
<td>0.624000</td>
<td>6.623500</td>
<td>94.075000</td>
<td>5.188425</td>
<td>24.000000</td>
<td>666.000000</td>
<td>20.200000</td>
<td>16.955000</td>
<td>25.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>88.976200</td>
<td>100.000000</td>
<td>27.740000</td>
<td>1.000000</td>
<td>0.871000</td>
<td>8.780000</td>
<td>100.000000</td>
<td>12.126500</td>
<td>24.000000</td>
<td>711.000000</td>
<td>22.000000</td>
<td>37.970000</td>
<td>50.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="a" class="level4" data-number="12.2.1.1">
<h4 data-number="12.2.1.1" class="anchored" data-anchor-id="a"><span class="header-section-number">12.2.1.1</span> (a)</h4>
<p>We need to fit one regression model for each covariates. One way to do this is as follows: You first make a set of all the covariates in the data, then use a dictionary comprehension to fit models for every single formula.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>covariates <span class="op">=</span> <span class="bu">set</span>(boston.columns.values.tolist()) <span class="op">-</span> <span class="bu">set</span>([<span class="st">"crim"</span>])</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>fits <span class="op">=</span> {cov: smf.ols(<span class="st">"crim ~ "</span> <span class="op">+</span> cov, data <span class="op">=</span> boston).fit() <span class="cf">for</span> cov <span class="kw">in</span> covariates}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s advisable to use <code>pprint</code> to display this data, as it makes it easier on the eyes.</p>
<p>Here we take a look at the p-values and <span class="math inline">\(R^2\)</span>s for each fit.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pp <span class="op">=</span> pprint.PrettyPrinter(indent<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>pp.pprint([(key, value.rsquared.<span class="bu">round</span>(<span class="dv">2</span>), value.pvalues[<span class="dv">1</span>].<span class="bu">round</span>(<span class="dv">3</span>)) <span class="cf">for</span> key, value <span class="kw">in</span> fits.items()])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[   ('chas', 0.0, 0.209),
    ('dis', 0.14, 0.0),
    ('medv', 0.15, 0.0),
    ('indus', 0.17, 0.0),
    ('tax', 0.34, 0.0),
    ('nox', 0.18, 0.0),
    ('age', 0.12, 0.0),
    ('ptratio', 0.08, 0.0),
    ('rm', 0.05, 0.0),
    ('lstat', 0.21, 0.0),
    ('zn', 0.04, 0.0),
    ('rad', 0.39, 0.0)]</code></pre>
</div>
</div>
<p>It’s clear that all p-values except <code>chas</code> are 0, thus almost every covariate has some relationship with <code>crim</code>. The highest <span class="math inline">\(R^2\)</span> belong to <code>tax</code> and <code>rad</code>.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(boston.rad, boston.crim)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>plt.plot(boston.rad, fits[<span class="st">"rad"</span>].params[<span class="dv">0</span>] <span class="op">+</span> fits[<span class="st">"rad"</span>].params[<span class="dv">1</span>] <span class="op">*</span> boston.rad)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="13-inference-for-linear-regression_files/figure-html/cell-8-output-1.png" width="572" height="411"></p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(boston.tax, boston.crim)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>plt.plot(boston.tax, fits[<span class="st">"tax"</span>].params[<span class="dv">0</span>] <span class="op">+</span> fits[<span class="st">"tax"</span>].params[<span class="dv">1</span>] <span class="op">*</span> boston.tax)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plt.plot(boston.tax, fits[<span class="st">"tax"</span>].predict())</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="13-inference-for-linear-regression_files/figure-html/cell-9-output-1.png" width="566" height="411"></p>
</div>
</div>
<p>Observe that these plots are nearly identical. Moreover, the relationship is evidently not linear. It rather seems like there are two distinct clusters of observations. One could plausibly model this sort of scenario using decision trees, which is a subject of your next course.</p>
<p>When two variables look very similar when plotted in this way, it is reasonable to calculate their correlation and make a plot of them to see if they measure essentially different things.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(boston.tax, boston.rad)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>np.corrcoef(boston.tax, boston.rad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="13-inference-for-linear-regression_files/figure-html/cell-10-output-1.png" width="566" height="414"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>array([[1.        , 0.91022819],
       [0.91022819, 1.        ]])</code></pre>
</div>
</div>
<p>It’s hard to see from this plot why the correlation is so large. The reason is repeated observations. In particular, the number of observations for the point (24,666) is 132, which causes the high correlation. On way to show this is by using the <code>Counter</code> function.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>pp.pprint(Counter(<span class="bu">zip</span>(boston.rad, boston.tax)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Counter({   (24, 666): 132,
            (5, 403): 30,
            (4, 307): 22,
            (8, 307): 18,
            (4, 437): 15,
            (5, 398): 12,
            (5, 264): 12,
            (4, 304): 12,
            (5, 384): 11,
            (4, 277): 11,
            (7, 330): 10,
            (3, 233): 9,
            (6, 432): 9,
            (3, 193): 8,
            (5, 287): 8,
            (5, 224): 8,
            (6, 391): 8,
            (5, 311): 7,
            (2, 188): 7,
            (5, 296): 7,
            (8, 284): 6,
            (6, 300): 6,
            (2, 276): 5,
            (3, 223): 5,
            (4, 254): 5,
            (4, 289): 5,
            (4, 711): 5,
            (1, 273): 5,
            (5, 279): 4,
            (4, 243): 4,
            (4, 305): 4,
            (4, 281): 4,
            (3, 247): 4,
            (2, 270): 4,
            (5, 276): 4,
            (5, 216): 4,
            (7, 222): 4,
            (3, 222): 3,
            (4, 345): 3,
            (4, 270): 3,
            (2, 329): 3,
            (6, 293): 3,
            (4, 245): 3,
            (5, 358): 3,
            (7, 329): 3,
            (4, 430): 3,
            (2, 242): 2,
            (3, 252): 2,
            (4, 337): 2,
            (1, 265): 2,
            (3, 402): 2,
            (2, 348): 2,
            (4, 224): 2,
            (1, 315): 2,
            (1, 304): 2,
            (5, 370): 2,
            (3, 352): 2,
            (1, 335): 2,
            (4, 411): 2,
            (4, 334): 2,
            (1, 296): 1,
            (3, 469): 1,
            (5, 226): 1,
            (2, 313): 1,
            (5, 256): 1,
            (3, 216): 1,
            (4, 255): 1,
            (3, 244): 1,
            (1, 198): 1,
            (1, 285): 1,
            (1, 300): 1,
            (1, 241): 1,
            (1, 284): 1,
            (1, 422): 1,
            (4, 351): 1,
            (4, 280): 1,
            (5, 187): 1})</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="b" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> (b)</h1>
<p>We must join together <code>crim</code> with all covariates in the table except <code>crim</code>.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="st">"crim"</span> <span class="op">+</span> <span class="st">"~"</span> <span class="op">+</span> <span class="st">"+"</span>.join(boston.columns.difference([<span class="st">"crim"</span>]))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fit <span class="op">=</span> smf.ols(formula, boston).fit()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>fit.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>crim</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.449</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.436</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>33.52</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Wed, 15 Nov 2023</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>2.03e-56</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>13:58:54</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-1655.4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>506</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>3337.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>493</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>3392.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>12</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>13.7784</td>
<td>7.082</td>
<td>1.946</td>
<td>0.052</td>
<td>-0.136</td>
<td>27.693</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">age</td>
<td>-0.0008</td>
<td>0.018</td>
<td>-0.047</td>
<td>0.962</td>
<td>-0.036</td>
<td>0.034</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">chas</td>
<td>-0.8254</td>
<td>1.183</td>
<td>-0.697</td>
<td>0.486</td>
<td>-3.150</td>
<td>1.500</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">dis</td>
<td>-1.0122</td>
<td>0.282</td>
<td>-3.584</td>
<td>0.000</td>
<td>-1.567</td>
<td>-0.457</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">indus</td>
<td>-0.0584</td>
<td>0.084</td>
<td>-0.698</td>
<td>0.486</td>
<td>-0.223</td>
<td>0.106</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lstat</td>
<td>0.1388</td>
<td>0.076</td>
<td>1.833</td>
<td>0.067</td>
<td>-0.010</td>
<td>0.288</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">medv</td>
<td>-0.2201</td>
<td>0.060</td>
<td>-3.678</td>
<td>0.000</td>
<td>-0.338</td>
<td>-0.103</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">nox</td>
<td>-9.9576</td>
<td>5.290</td>
<td>-1.882</td>
<td>0.060</td>
<td>-20.351</td>
<td>0.436</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ptratio</td>
<td>-0.3041</td>
<td>0.186</td>
<td>-1.632</td>
<td>0.103</td>
<td>-0.670</td>
<td>0.062</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">rad</td>
<td>0.6125</td>
<td>0.088</td>
<td>6.997</td>
<td>0.000</td>
<td>0.440</td>
<td>0.784</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">rm</td>
<td>0.6289</td>
<td>0.607</td>
<td>1.036</td>
<td>0.301</td>
<td>-0.564</td>
<td>1.822</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">tax</td>
<td>-0.0038</td>
<td>0.005</td>
<td>-0.730</td>
<td>0.466</td>
<td>-0.014</td>
<td>0.006</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">zn</td>
<td>0.0457</td>
<td>0.019</td>
<td>2.433</td>
<td>0.015</td>
<td>0.009</td>
<td>0.083</td>
</tr>
</tbody>
</table>
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>663.436</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>1.516</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.000</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>80856.852</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>6.579</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>63.514</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>1.24e+04</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br>[2] The condition number is large, 1.24e+04. This might indicate that there are<br>strong multicollinearity or other numerical problems.
</div>
</div>
<p>Note that many covariates are not significant anymore. In particular, <code>tax</code> is not significant! Try to understand why; the reason is explained in the previous exercise.</p>
</section>
<section id="c" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> (c)</h1>
<p>We need to sort the univariate results from exercise (a) before plotting, as the covariates in exercise (b) are already sorted. To do this, we extract the relevant parameters. These are the slope parameters.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>uni_ <span class="op">=</span> <span class="bu">sorted</span>([(cov, fit.params[<span class="dv">1</span>]) <span class="cf">for</span> cov, fit <span class="kw">in</span> fits.items()])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>pp.pprint(uni_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[   ('age', 0.1077862271395331),
    ('chas', -1.892776550803758),
    ('dis', -1.5509016824100994),
    ('indus', 0.5097763311042306),
    ('lstat', 0.5488047820623981),
    ('medv', -0.363159922257603),
    ('nox', 31.248531201122923),
    ('ptratio', 1.1519827870705872),
    ('rad', 0.6179109273272014),
    ('rm', -2.684051224113948),
    ('tax', 0.02974225282276537),
    ('zn', -0.07393497740412368)]</code></pre>
</div>
</div>
<p>To plot the parameter values we must remove the covariate names from the list. (Or turn our data into a data frame; there are many ways to solve this exercise.)</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>uni <span class="op">=</span> [x <span class="cf">for</span> i,x <span class="kw">in</span> uni_]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <span class="math inline">\(y\)</span>-axis are the non-intercept parameters from <code>fit</code>.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>multi <span class="op">=</span> fit.params[<span class="dv">1</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(uni, multi)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="13-inference-for-linear-regression_files/figure-html/cell-16-output-1.png" width="577" height="411"></p>
</div>
</div>
<p>The parameters are widely different. This is to be expected. In general, whenever you add or remove parameters from a regression model, the parameters may fluctuate!</p>
<p>The most extreme change occurs at the lower-right corner. Which covariate is this? One way to find out is to do the following:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pp.pprint({cov: (x, y) <span class="cf">for</span> (cov, x), y <span class="kw">in</span> <span class="bu">zip</span>(uni_, multi)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{   'age': (0.1077862271395331, -0.0008482790661906402),
    'chas': (-1.892776550803758, -0.8253775522410146),
    'dis': (-1.5509016824100994, -1.0122467382083935),
    'indus': (0.5097763311042306, -0.058350110665981544),
    'lstat': (0.5488047820623981, 0.1388005967767626),
    'medv': (-0.363159922257603, -0.22005635903920306),
    'nox': (31.248531201122923, -9.957586547089225),
    'ptratio': (1.1519827870705872, -0.3040727572312342),
    'rad': (0.6179109273272014, 0.6124653114967983),
    'rm': (-2.684051224113948, 0.6289106621781995),
    'tax': (0.02974225282276537, -0.0037756465234424076),
    'zn': (-0.07393497740412368, 0.04571003863975589)}</code></pre>
</div>
</div>
<p>The variable with the largest change is <code>nox</code>.</p>
<section id="d" class="level4" data-number="14.0.0.1">
<h4 data-number="14.0.0.1" class="anchored" data-anchor-id="d"><span class="header-section-number">14.0.0.1</span> (d)</h4>
<p>This is a somewhat strange question. You know there is no-linearity from exercise (a). However, running a cubic regression can detect non-linearity in the following sense: If the data is non-linear (and <span class="math inline">\(n\)</span> is high enough), it is likely that a cubic regression will fit better than a non-linear regression AND that either the quadratic coefficient or the cubic coefficient will be significant.</p>
<p>To fit the cubic regression we should use f-strings. Look them up if you haven’t seen them, they are very useful.</p>
<p>We make the fits as we did in exercise (a).</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="kw">lambda</span> x: <span class="ss">f"crim ~ </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> + I(</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">**2) + I(</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">**3)"</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>fits_cubic <span class="op">=</span> {cov: smf.ols(formula(cov), boston).fit() <span class="cf">for</span> cov <span class="kw">in</span> covariates}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we print the p-values for the quadratic and cubic coeffients:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>pp.pprint([(cov, fit.pvalues[<span class="dv">2</span>].<span class="bu">round</span>(<span class="dv">3</span>), fit.pvalues[<span class="dv">3</span>].<span class="bu">round</span>(<span class="dv">3</span>)) <span class="cf">for</span> cov, fit <span class="kw">in</span> fits_cubic.items()])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[   ('chas', 0.681, 0.681),
    ('dis', 0.0, 0.0),
    ('medv', 0.0, 0.0),
    ('indus', 0.0, 0.0),
    ('tax', 0.137, 0.244),
    ('nox', 0.0, 0.0),
    ('age', 0.047, 0.007),
    ('ptratio', 0.004, 0.006),
    ('rm', 0.364, 0.509),
    ('lstat', 0.065, 0.13),
    ('zn', 0.094, 0.23),
    ('rad', 0.613, 0.482)]</code></pre>
</div>
</div>
<p>Observe that most covariates have significant quadratic or cubic coefficients. However, <code>tax</code> and <code>rad</code> do not. This demonstrates that the method of using cubic regression is not sufficient to uncover non-linearity.</p>
<p>Which of the models would benefit from using cubic regressions? One way to find out is to compare the <span class="math inline">\(R^2\)</span>s of both models.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>pp.pprint({cov: (fit.rsquared_adj <span class="op">-</span> fit_c.rsquared_adj).<span class="bu">round</span>(<span class="dv">3</span>) <span class="cf">for</span> (cov, fit), fit_c <span class="kw">in</span> <span class="bu">zip</span>(fits.items(), fits_cubic.values())})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{   'age': -0.047,
    'chas': 0.002,
    'dis': -0.131,
    'indus': -0.092,
    'lstat': -0.007,
    'medv': -0.268,
    'nox': -0.117,
    'ptratio': -0.026,
    'rad': -0.006,
    'rm': -0.016,
    'tax': -0.027,
    'zn': -0.014}</code></pre>
</div>
</div>
<p>The difference is negative if the cubic is best, positive if not. Now we find that the cubic model works better for every model except <code>chas</code>, though only marginally so (the only covariates with a decent difference are <code>dis</code>, <code>medv</code>, and <code>nox</code>).</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../site/12-basics-of-linear-regression.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Basics of multiple linear regression</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../site/14-binary-regression.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Binary regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>